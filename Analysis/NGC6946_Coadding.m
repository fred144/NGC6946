% Don't forget to add all the calibrated .fits files into the file path.
% ctrl + enter on a section runs only that section
%% Opening All 10/08 Calibrated Frames  
HA1008_1 = rfits('1008-calibrated-ha-1.fit'); HA1008_1 = HA1008_1.data; 
HA1008_2 = rfits('1008-calibrated-ha-2.fit'); HA1008_2 = HA1008_2.data;
HA1008_3 = rfits('1008-calibrated-ha-3.fit'); HA1008_3 = HA1008_3.data;
HA1008_4 = rfits('1008-calibrated-ha-4.fit'); HA1008_4 = HA1008_4.data;
HA1008_5 = rfits('1008-calibrated-ha-5.fit'); HA1008_5 = HA1008_5.data;
HA1008_6 = rfits('1008-calibrated-ha-6.fit'); HA1008_6 = HA1008_6.data;
HA1008_7 = rfits('1008-calibrated-ha-7.fit'); HA1008_7 = HA1008_7.data;
HA1008_8 = rfits('1008-calibrated-ha-8.fit'); HA1008_8 = HA1008_8.data;
HA1008_9 = rfits('1008-calibrated-ha-9.fit'); HA1008_9 = HA1008_9.data;
HA1008_10 = rfits('1008-calibrated-ha-10.fit'); HA1008_10 = HA1008_10.data;
HA1008_11 = rfits('1008-calibrated-ha-11.fit'); HA1008_11 = HA1008_11.data;
%---------------------------------------------------------------------------
JCB1008_1 = rfits('1008-calibrated-jcb-1.fit'); JCB1008_1 = JCB1008_1.data; 
JCB1008_2 = rfits('1008-calibrated-jcb-2.fit'); JCB1008_2 = JCB1008_2.data;
JCB1008_3 = rfits('1008-calibrated-jcb-3.fit'); JCB1008_3 = JCB1008_3.data;
JCB1008_4 = rfits('1008-calibrated-jcb-4.fit'); JCB1008_4 = JCB1008_4.data;
JCB1008_5 = rfits('1008-calibrated-jcb-5.fit'); JCB1008_5 = JCB1008_5.data;
JCB1008_6 = rfits('1008-calibrated-jcb-6.fit'); JCB1008_6 = JCB1008_6.data;
JCB1008_7 = rfits('1008-calibrated-jcb-7.fit'); JCB1008_7 = JCB1008_7.data;
JCB1008_8 = rfits('1008-calibrated-jcb-8.fit'); JCB1008_8 = JCB1008_8.data;
JCB1008_9 = rfits('1008-calibrated-jcb-9.fit'); JCB1008_9 = JCB1008_9.data;
JCB1008_10 = rfits('1008-calibrated-jcb-10.fit'); JCB1008_10 = JCB1008_10.data;
JCB1008_11 = rfits('1008-calibrated-jcb-11.fit'); JCB1008_11 = JCB1008_11.data;
%% Opening All 10/07 Calibrated Frames  
HA1007_1 = rfits('1007-calibrated-ha-1.fit'); HA1007_1 = HA1007_1.data; 
HA1007_2 = rfits('1007-calibrated-ha-2.fit'); HA1007_2 = HA1007_2.data;
HA1007_3 = rfits('1007-calibrated-ha-3.fit'); HA1007_3 = HA1007_3.data;
HA1007_4 = rfits('1007-calibrated-ha-4.fit'); HA1007_4 = HA1007_4.data;
HA1007_5 = rfits('1007-calibrated-ha-5.fit'); HA1007_5 = HA1007_5.data;
HA1007_6 = rfits('1007-calibrated-ha-6.fit'); HA1007_6 = HA1007_6.data;
HA1007_7 = rfits('1007-calibrated-ha-7.fit'); HA1007_7 = HA1007_7.data;
HA1007_8 = rfits('1007-calibrated-ha-8.fit'); HA1007_8 = HA1007_8.data;
HA1007_9 = rfits('1007-calibrated-ha-9.fit'); HA1007_9 = HA1007_9.data;
HA1007_10 = rfits('1007-calibrated-ha-10.fit'); HA1007_10 = HA1007_10.data;
HA1007_11 = rfits('1007-calibrated-ha-11.fit'); HA1007_11 = HA1007_11.data;
HA1007_12 = rfits('1007-calibrated-ha-12.fit'); HA1007_12 = HA1007_12.data;
HA1007_13 = rfits('1007-calibrated-ha-13.fit'); HA1007_13 = HA1007_13.data;
HA1007_14 = rfits('1007-calibrated-ha-14.fit'); HA1007_14 = HA1007_14.data;
HA1007_15 = rfits('1007-calibrated-ha-15.fit'); HA1007_15 = HA1007_15.data;
HA1007_16 = rfits('1007-calibrated-ha-16.fit'); HA1007_16 = HA1007_16.data;
HA1007_17 = rfits('1007-calibrated-ha-17.fit'); HA1007_17 = HA1007_17.data;
HA1007_18 = rfits('1007-calibrated-ha-18.fit'); HA1007_18 = HA1007_18.data;
HA1007_19 = rfits('1007-calibrated-ha-19.fit'); HA1007_19 = HA1007_19.data;
HA1007_20 = rfits('1007-calibrated-ha-20.fit'); HA1007_20 = HA1007_20.data;
HA1007_21 = rfits('1007-calibrated-ha-21.fit'); HA1007_21 = HA1007_21.data;
HA1007_22 = rfits('1007-calibrated-ha-22.fit'); HA1007_22 = HA1007_22.data;
HA1007_23 = rfits('1007-calibrated-ha-23.fit'); HA1007_23 = HA1007_23.data;
HA1007_24 = rfits('1007-calibrated-ha-24.fit'); HA1007_24 = HA1007_24.data;
HA1007_25 = rfits('1007-calibrated-ha-25.fit'); HA1007_25 = HA1007_25.data;
HA1007_26 = rfits('1007-calibrated-ha-26.fit'); HA1007_26 = HA1007_26.data;
HA1007_27 = rfits('1007-calibrated-ha-27.fit'); HA1007_27 = HA1007_27.data;
HA1007_28 = rfits('1007-calibrated-ha-28.fit'); HA1007_28 = HA1007_28.data;
HA1007_29 = rfits('1007-calibrated-ha-29.fit'); HA1007_29 = HA1007_29.data;
HA1007_30 = rfits('1007-calibrated-ha-30.fit'); HA1007_30 = HA1007_30.data;
HA1007_31 = rfits('1007-calibrated-ha-31.fit'); HA1007_31 = HA1007_31.data;
HA1007_32 = rfits('1007-calibrated-ha-32.fit'); HA1007_32 = HA1007_32.data;
HA1007_33 = rfits('1007-calibrated-ha-33.fit'); HA1007_33 = HA1007_33.data;
HA1007_34 = rfits('1007-calibrated-ha-34.fit'); HA1007_34 = HA1007_34.data;
HA1007_35 = rfits('1007-calibrated-ha-35.fit'); HA1007_35 = HA1007_35.data;
HA1007_36 = rfits('1007-calibrated-ha-36.fit'); HA1007_36 = HA1007_36.data;
HA1007_37 = rfits('1007-calibrated-ha-37.fit'); HA1007_37 = HA1007_37.data;
HA1007_38 = rfits('1007-calibrated-ha-38.fit'); HA1007_38 = HA1007_38.data;
HA1007_39 = rfits('1007-calibrated-ha-39.fit'); HA1007_39 = HA1007_39.data;
HA1007_40 = rfits('1007-calibrated-ha-40.fit'); HA1007_40 = HA1007_40.data;
%---------------------------------------------------------------------------------
JCB1007_1 = rfits('1007-calibrated-jcb-1.fit'); JCB1007_1 = JCB1007_1.data; 
JCB1007_2 = rfits('1007-calibrated-jcb-2.fit'); JCB1007_2 = JCB1007_2.data;
JCB1007_3 = rfits('1007-calibrated-jcb-3.fit'); JCB1007_3 = JCB1007_3.data;
JCB1007_4 = rfits('1007-calibrated-jcb-4.fit'); JCB1007_4 = JCB1007_4.data;
JCB1007_5 = rfits('1007-calibrated-jcb-5.fit'); JCB1007_5 = JCB1007_5.data;
JCB1007_6 = rfits('1007-calibrated-jcb-6.fit'); JCB1007_6 = JCB1007_6.data;
JCB1007_7 = rfits('1007-calibrated-jcb-7.fit'); JCB1007_7 = JCB1007_7.data;
JCB1007_8 = rfits('1007-calibrated-jcb-8.fit'); JCB1007_8 = JCB1007_8.data;
JCB1007_9 = rfits('1007-calibrated-jcb-9.fit'); JCB1007_9 = JCB1007_9.data;
JCB1007_10 = rfits('1007-calibrated-jcb-10.fit'); JCB1007_10 = JCB1007_10.data;
JCB1007_11 = rfits('1007-calibrated-jcb-11.fit'); JCB1007_11 = JCB1007_11.data;
JCB1007_12 = rfits('1007-calibrated-jcb-12.fit'); JCB1007_12 = JCB1007_12.data;
JCB1007_13 = rfits('1007-calibrated-jcb-13.fit'); JCB1007_13 = JCB1007_13.data;
JCB1007_14 = rfits('1007-calibrated-jcb-14.fit'); JCB1007_14 = JCB1007_14.data;
JCB1007_15 = rfits('1007-calibrated-jcb-15.fit'); JCB1007_15 = JCB1007_15.data;
JCB1007_16 = rfits('1007-calibrated-jcb-16.fit'); JCB1007_16 = JCB1007_16.data;
JCB1007_17 = rfits('1007-calibrated-jcb-17.fit'); JCB1007_17 = JCB1007_17.data;
JCB1007_18 = rfits('1007-calibrated-jcb-18.fit'); JCB1007_18 = JCB1007_18.data;
JCB1007_19 = rfits('1007-calibrated-jcb-19.fit'); JCB1007_19 = JCB1007_19.data;
JCB1007_20 = rfits('1007-calibrated-jcb-20.fit'); JCB1007_20 = JCB1007_20.data;
JCB1007_21 = rfits('1007-calibrated-jcb-21.fit'); JCB1007_21 = JCB1007_21.data;
JCB1007_22 = rfits('1007-calibrated-jcb-22.fit'); JCB1007_22 = JCB1007_22.data;
JCB1007_23 = rfits('1007-calibrated-jcb-23.fit'); JCB1007_23 = JCB1007_23.data;
JCB1007_24 = rfits('1007-calibrated-jcb-24.fit'); JCB1007_24 = JCB1007_24.data;
JCB1007_25 = rfits('1007-calibrated-jcb-25.fit'); JCB1007_25 = JCB1007_25.data;
JCB1007_26 = rfits('1007-calibrated-jcb-26.fit'); JCB1007_26 = JCB1007_26.data;
JCB1007_27 = rfits('1007-calibrated-jcb-27.fit'); JCB1007_27 = JCB1007_27.data;
JCB1007_28 = rfits('1007-calibrated-jcb-28.fit'); JCB1007_28 = JCB1007_28.data;
JCB1007_29 = rfits('1007-calibrated-jcb-29.fit'); JCB1007_29 = JCB1007_29.data;
JCB1007_30 = rfits('1007-calibrated-jcb-30.fit'); JCB1007_30 = JCB1007_30.data;
JCB1007_31 = rfits('1007-calibrated-jcb-31.fit'); JCB1007_31 = JCB1007_31.data;
JCB1007_32 = rfits('1007-calibrated-jcb-32.fit'); JCB1007_32 = JCB1007_32.data;
JCB1007_33 = rfits('1007-calibrated-jcb-33.fit'); JCB1007_33 = JCB1007_33.data;
JCB1007_34 = rfits('1007-calibrated-jcb-34.fit'); JCB1007_34 = JCB1007_34.data;
JCB1007_35 = rfits('1007-calibrated-jcb-35.fit'); JCB1007_35 = JCB1007_35.data;
JCB1007_36 = rfits('1007-calibrated-jcb-36.fit'); JCB1007_36 = JCB1007_36.data;
JCB1007_37 = rfits('1007-calibrated-jcb-37.fit'); JCB1007_37 = JCB1007_37.data;
JCB1007_38 = rfits('1007-calibrated-jcb-38.fit'); JCB1007_38 = JCB1007_38.data;
JCB1007_39 = rfits('1007-calibrated-jcb-39.fit'); JCB1007_39 = JCB1007_39.data;
JCB1007_40 = rfits('1007-calibrated-jcb-40.fit'); JCB1007_40 = JCB1007_40.data;
%% Opening All 09/30 Calibrated Frames  
HA0930_1 = rfits('0930-calibrated-ha-1.fit'); HA0930_1 = HA0930_1.data; 
HA0930_2 = rfits('0930-calibrated-ha-2.fit'); HA0930_2 = HA0930_2.data;
HA0930_3 = rfits('0930-calibrated-ha-3.fit'); HA0930_3 = HA0930_3.data;
HA0930_4 = rfits('0930-calibrated-ha-4.fit'); HA0930_4 = HA0930_4.data;
HA0930_5 = rfits('0930-calibrated-ha-5.fit'); HA0930_5 = HA0930_5.data;
HA0930_6 = rfits('0930-calibrated-ha-6.fit'); HA0930_6 = HA0930_6.data;
HA0930_7 = rfits('0930-calibrated-ha-7.fit'); HA0930_7 = HA0930_7.data;
HA0930_8 = rfits('0930-calibrated-ha-8.fit'); HA0930_8 = HA0930_8.data;
HA0930_9 = rfits('0930-calibrated-ha-9.fit'); HA0930_9 = HA0930_9.data;
HA0930_10 = rfits('0930-calibrated-ha-10.fit'); HA0930_10 = HA0930_10.data;
%-----------------------------------------------------------------------------------
JCB0930_1 = rfits('0930-calibrated-jcb-1.fit'); JCB0930_1 = JCB0930_1.data; 
JCB0930_2 = rfits('0930-calibrated-jcb-2.fit'); JCB0930_2 = JCB0930_2.data;
JCB0930_3 = rfits('0930-calibrated-jcb-3.fit'); JCB0930_3 = JCB0930_3.data;
JCB0930_4 = rfits('0930-calibrated-jcb-4.fit'); JCB0930_4 = JCB0930_4.data;
JCB0930_5 = rfits('0930-calibrated-jcb-5.fit'); JCB0930_5 = JCB0930_5.data;
JCB0930_6 = rfits('0930-calibrated-jcb-6.fit'); JCB0930_6 = JCB0930_6.data;
JCB0930_7 = rfits('0930-calibrated-jcb-7.fit'); JCB0930_7 = JCB0930_7.data;
JCB0930_8 = rfits('0930-calibrated-jcb-8.fit'); JCB0930_8 = JCB0930_8.data;
JCB0930_9 = rfits('0930-calibrated-jcb-9.fit'); JCB0930_9 = JCB0930_9.data;
JCB0930_10 = rfits('0930-calibrated-jcb-10.fit'); JCB0930_10 = JCB0930_10.data;
%% Coadding 09/30
for i = 1:10
    filename = eval(sprintf("JCB0930_%i", i));
    localmax = filename(1000:1100, 290:345);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("JCB0930_%i", i))== max_array);
end
shifted_JCB_2 = imshift(JCB0930_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_JCB_3 = imshift(JCB0930_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_JCB_4 = imshift(JCB0930_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_JCB_5 = imshift(JCB0930_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_JCB_6 = imshift(JCB0930_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_JCB_7 = imshift(JCB0930_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_JCB_8 = imshift(JCB0930_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_JCB_9 = imshift(JCB0930_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_JCB_10 = imshift(JCB0930_10, maxx(1) - maxx(10), maxy(1) - maxy(10));

stacked_jcb_0930 = sum(cat(3, JCB0930_1, shifted_JCB_2, shifted_JCB_3, shifted_JCB_4, shifted_JCB_5, shifted_JCB_6, shifted_JCB_7, shifted_JCB_8, shifted_JCB_9, shifted_JCB_10), 3);

figure(1)
colormap(gray(256));
imagesc(rot90(stacked_jcb_0930), [9700,10080]); colorbar();


%HA
 for i = 1:10
    filename = eval(sprintf("HA0930_%i", i));
    localmax = filename(1010:1060, 290:345);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("HA0930_%i", i))== max_array);
 end

shifted_HA_2 = imshift(HA0930_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_HA_3 = imshift(HA0930_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_HA_4 = imshift(HA0930_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_HA_5 = imshift(HA0930_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_HA_6 = imshift(HA0930_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_HA_7 = imshift(HA0930_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_HA_8 = imshift(HA0930_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_HA_9 = imshift(HA0930_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_HA_10 = imshift(HA0930_10, maxx(1) - maxx(10), maxy(1) - maxy(10));

stacked_ha_0930 = sum(cat(3, HA0930_1, shifted_HA_2, shifted_HA_3, shifted_HA_4, shifted_HA_5, shifted_HA_6, shifted_HA_7, shifted_HA_8, shifted_HA_9, shifted_HA_10), 3);

figure(2)
colormap(gray(256));
imagesc(rot90(stacked_ha_0930), [900,1800]); colorbar();
%% Coadding 10/07
for i = 1:40
    filename = eval(sprintf("JCB1007_%i", i));
    localmax = filename(940:1040, 1160:1260);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("JCB1007_%i", i))== max_array);
end

shifted_JCB_2 = imshift(JCB1007_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_JCB_3 = imshift(JCB1007_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_JCB_4 = imshift(JCB1007_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_JCB_5 = imshift(JCB1007_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_JCB_6 = imshift(JCB1007_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_JCB_7 = imshift(JCB1007_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_JCB_8 = imshift(JCB1007_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_JCB_9 = imshift(JCB1007_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_JCB_10 = imshift(JCB1007_10, maxx(1) - maxx(10), maxy(1) - maxy(10));
shifted_JCB_11 = imshift(JCB1007_11, maxx(1) - maxx(11), maxy(1) - maxy(11));
shifted_JCB_12 = imshift(JCB1007_12, maxx(1) - maxx(12), maxy(1) - maxy(12));
shifted_JCB_13 = imshift(JCB1007_13, maxx(1) - maxx(13), maxy(1) - maxy(13));
shifted_JCB_14 = imshift(JCB1007_14, maxx(1) - maxx(14), maxy(1) - maxy(14));
shifted_JCB_15 = imshift(JCB1007_15, maxx(1) - maxx(15), maxy(1) - maxy(15));
shifted_JCB_16 = imshift(JCB1007_16, maxx(1) - maxx(16), maxy(1) - maxy(16));
shifted_JCB_17 = imshift(JCB1007_17, maxx(1) - maxx(17), maxy(1) - maxy(17));
shifted_JCB_18 = imshift(JCB1007_18, maxx(1) - maxx(18), maxy(1) - maxy(18));
shifted_JCB_19 = imshift(JCB1007_19, maxx(1) - maxx(19), maxy(1) - maxy(19));
shifted_JCB_20 = imshift(JCB1007_20, maxx(1) - maxx(20), maxy(1) - maxy(20));
shifted_JCB_21 = imshift(JCB1007_21, maxx(1) - maxx(21), maxy(1) - maxy(21));
shifted_JCB_22 = imshift(JCB1007_22, maxx(1) - maxx(22), maxy(1) - maxy(22));
shifted_JCB_23 = imshift(JCB1007_23, maxx(1) - maxx(23), maxy(1) - maxy(23));
shifted_JCB_24 = imshift(JCB1007_24, maxx(1) - maxx(24), maxy(1) - maxy(24));
shifted_JCB_25 = imshift(JCB1007_25, maxx(1) - maxx(25), maxy(1) - maxy(25));
shifted_JCB_26 = imshift(JCB1007_26, maxx(1) - maxx(26), maxy(1) - maxy(26));
shifted_JCB_27 = imshift(JCB1007_27, maxx(1) - maxx(27), maxy(1) - maxy(27));
shifted_JCB_28 = imshift(JCB1007_28, maxx(1) - maxx(28), maxy(1) - maxy(28));
shifted_JCB_29 = imshift(JCB1007_29, maxx(1) - maxx(29), maxy(1) - maxy(29));
shifted_JCB_30 = imshift(JCB1007_30, maxx(1) - maxx(30), maxy(1) - maxy(30));
shifted_JCB_31 = imshift(JCB1007_31, maxx(1) - maxx(31), maxy(1) - maxy(31));
shifted_JCB_32 = imshift(JCB1007_32, maxx(1) - maxx(32), maxy(1) - maxy(32));
shifted_JCB_33 = imshift(JCB1007_33, maxx(1) - maxx(33), maxy(1) - maxy(33));
shifted_JCB_34 = imshift(JCB1007_34, maxx(1) - maxx(34), maxy(1) - maxy(34));
shifted_JCB_35 = imshift(JCB1007_35, maxx(1) - maxx(35), maxy(1) - maxy(35));
shifted_JCB_36 = imshift(JCB1007_36, maxx(1) - maxx(36), maxy(1) - maxy(36));
shifted_JCB_37 = imshift(JCB1007_37, maxx(1) - maxx(37), maxy(1) - maxy(37));
shifted_JCB_38 = imshift(JCB1007_38, maxx(1) - maxx(38), maxy(1) - maxy(38));
shifted_JCB_39 = imshift(JCB1007_39, maxx(1) - maxx(39), maxy(1) - maxy(39));
shifted_JCB_40 = imshift(JCB1007_40, maxx(1) - maxx(40), maxy(1) - maxy(40));

stacked_jcb_1007 = sum(cat(3, JCB1007_1, shifted_JCB_2, shifted_JCB_3, shifted_JCB_4, shifted_JCB_5, shifted_JCB_6, shifted_JCB_7, shifted_JCB_8, shifted_JCB_9, shifted_JCB_10, shifted_JCB_11,shifted_JCB_12,shifted_JCB_13,shifted_JCB_14,shifted_JCB_15,shifted_JCB_16,shifted_JCB_17,shifted_JCB_18,shifted_JCB_19,shifted_JCB_20,shifted_JCB_21,shifted_JCB_22,shifted_JCB_23,shifted_JCB_24,shifted_JCB_25,shifted_JCB_26,shifted_JCB_27,shifted_JCB_28,shifted_JCB_29,shifted_JCB_30,shifted_JCB_31,shifted_JCB_32,shifted_JCB_33,shifted_JCB_34,shifted_JCB_35,shifted_JCB_36,shifted_JCB_37,shifted_JCB_38,shifted_JCB_39,shifted_JCB_40), 3);

figure(3)
colormap(gray(256));
imagesc(rot90(stacked_jcb_1007), [15000,17000]); colorbar();

%HA
 for i = 1:40
    filename = eval(sprintf("HA1007_%i", i));
    localmax = filename(950:1050, 1150:1250);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("HA1007_%i", i))== max_array);
 end

shifted_HA_2 = imshift(HA1007_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_HA_3 = imshift(HA1007_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_HA_4 = imshift(HA1007_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_HA_5 = imshift(HA1007_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_HA_6 = imshift(HA1007_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_HA_7 = imshift(HA1007_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_HA_8 = imshift(HA1007_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_HA_9 = imshift(HA1007_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_HA_10 = imshift(HA1007_10, maxx(1) - maxx(10), maxy(1) - maxy(10));
shifted_HA_11 = imshift(HA1007_11, maxx(1) - maxx(11), maxy(1) - maxy(11));
shifted_HA_12 = imshift(HA1007_12, maxx(1) - maxx(12), maxy(1) - maxy(12));
shifted_HA_13 = imshift(HA1007_13, maxx(1) - maxx(13), maxy(1) - maxy(13));
shifted_HA_14 = imshift(HA1007_14, maxx(1) - maxx(14), maxy(1) - maxy(14));
shifted_HA_15 = imshift(HA1007_15, maxx(1) - maxx(15), maxy(1) - maxy(15));
shifted_HA_16 = imshift(HA1007_16, maxx(1) - maxx(16), maxy(1) - maxy(16));
shifted_HA_17 = imshift(HA1007_17, maxx(1) - maxx(17), maxy(1) - maxy(17));
shifted_HA_18 = imshift(HA1007_18, maxx(1) - maxx(18), maxy(1) - maxy(18));
shifted_HA_19 = imshift(HA1007_19, maxx(1) - maxx(19), maxy(1) - maxy(19));
shifted_HA_20 = imshift(HA1007_20, maxx(1) - maxx(20), maxy(1) - maxy(20));
shifted_HA_21 = imshift(HA1007_21, maxx(1) - maxx(21), maxy(1) - maxy(21));
shifted_HA_22 = imshift(HA1007_22, maxx(1) - maxx(22), maxy(1) - maxy(22));
shifted_HA_23 = imshift(HA1007_23, maxx(1) - maxx(23), maxy(1) - maxy(23));
shifted_HA_24 = imshift(HA1007_24, maxx(1) - maxx(24), maxy(1) - maxy(24));
shifted_HA_25 = imshift(HA1007_25, maxx(1) - maxx(25), maxy(1) - maxy(25));
shifted_HA_26 = imshift(HA1007_26, maxx(1) - maxx(26), maxy(1) - maxy(26));
shifted_HA_27 = imshift(HA1007_27, maxx(1) - maxx(27), maxy(1) - maxy(27));
shifted_HA_28 = imshift(HA1007_28, maxx(1) - maxx(28), maxy(1) - maxy(28));
shifted_HA_29 = imshift(HA1007_29, maxx(1) - maxx(29), maxy(1) - maxy(29));
shifted_HA_30 = imshift(HA1007_30, maxx(1) - maxx(30), maxy(1) - maxy(30));
shifted_HA_31 = imshift(HA1007_31, maxx(1) - maxx(31), maxy(1) - maxy(31));
shifted_HA_32 = imshift(HA1007_32, maxx(1) - maxx(32), maxy(1) - maxy(32));
shifted_HA_33 = imshift(HA1007_33, maxx(1) - maxx(33), maxy(1) - maxy(33));
shifted_HA_34 = imshift(HA1007_34, maxx(1) - maxx(34), maxy(1) - maxy(34));
shifted_HA_35 = imshift(HA1007_35, maxx(1) - maxx(35), maxy(1) - maxy(35));
shifted_HA_36 = imshift(HA1007_36, maxx(1) - maxx(36), maxy(1) - maxy(36));
shifted_HA_37 = imshift(HA1007_37, maxx(1) - maxx(37), maxy(1) - maxy(37));
shifted_HA_38 = imshift(HA1007_38, maxx(1) - maxx(38), maxy(1) - maxy(38));
shifted_HA_39 = imshift(HA1007_39, maxx(1) - maxx(39), maxy(1) - maxy(39));
shifted_HA_40 = imshift(HA1007_40, maxx(1) - maxx(40), maxy(1) - maxy(40));

stacked_ha_1007 = sum(cat(3, HA1007_1, shifted_HA_2, shifted_HA_3, shifted_HA_4, shifted_HA_5, shifted_HA_6, shifted_HA_7, shifted_HA_8, shifted_HA_9, shifted_HA_10, shifted_HA_11,shifted_HA_12,shifted_HA_13,shifted_HA_14,shifted_HA_15,shifted_HA_16,shifted_HA_17,shifted_HA_18,shifted_HA_19,shifted_HA_20,shifted_HA_21,shifted_HA_22,shifted_HA_23,shifted_HA_24,shifted_HA_25,shifted_HA_26,shifted_HA_27,shifted_HA_28,shifted_HA_29,shifted_HA_30,shifted_HA_31,shifted_HA_32,shifted_HA_33,shifted_HA_34,shifted_HA_35,shifted_HA_36,shifted_HA_37,shifted_HA_38,shifted_HA_39,shifted_HA_40), 3);

figure(4)
colormap(gray(256));
imagesc(rot90(stacked_ha_1007), [900,1800]); colorbar();
%% Coadding 10/08   
%JCB
for i = 1:11
    filename = eval(sprintf("JCB1008_%i", i));
    localmax = filename(1100:1200, 200:320);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("JCB1008_%i", i))== max_array);
end

shifted_JCB_2 = imshift(JCB1008_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_JCB_3 = imshift(JCB1008_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_JCB_4 = imshift(JCB1008_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_JCB_5 = imshift(JCB1008_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_JCB_6 = imshift(JCB1008_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_JCB_7 = imshift(JCB1008_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_JCB_8 = imshift(JCB1008_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_JCB_9 = imshift(JCB1008_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_JCB_10 = imshift(JCB1008_10, maxx(1) - maxx(10), maxy(1) - maxy(10));
shifted_JCB_11 = imshift(JCB1008_11, maxx(1) - maxx(11), maxy(1) - maxy(11));

stacked_jcb_1008 = sum(cat(3, JCB1008_1, shifted_JCB_2, shifted_JCB_3, shifted_JCB_4, shifted_JCB_5, shifted_JCB_6, shifted_JCB_7, shifted_JCB_8, shifted_JCB_9, shifted_JCB_10, shifted_JCB_11), 3);

figure(5)
colormap(gray(256));
imagesc(rot90(stacked_jcb_1008), [3350,3650]); colorbar();

%HA
 for i = 1:11
    filename = eval(sprintf("HA1008_%i", i));
    localmax = filename(1100:1200, 200:320);
    max_array = max(localmax(:));
    [maxx(i), maxy(i)] = find(eval(sprintf("HA1008_%i", i))== max_array);
 end

shifted_HA_2 = imshift(HA1008_2, maxx(1) - maxx(2), maxy(1) - maxy(2));
shifted_HA_3 = imshift(HA1008_3, maxx(1) - maxx(3), maxy(1) - maxy(3));
shifted_HA_4 = imshift(HA1008_4, maxx(1) - maxx(4), maxy(1) - maxy(4));
shifted_HA_5 = imshift(HA1008_5, maxx(1) - maxx(5), maxy(1) - maxy(5));
shifted_HA_6 = imshift(HA1008_6, maxx(1) - maxx(6), maxy(1) - maxy(6));
shifted_HA_7 = imshift(HA1008_7, maxx(1) - maxx(7), maxy(1) - maxy(7));
shifted_HA_8 = imshift(HA1008_8, maxx(1) - maxx(8), maxy(1) - maxy(8));
shifted_HA_9 = imshift(HA1008_9, maxx(1) - maxx(9), maxy(1) - maxy(9));
shifted_HA_10 = imshift(HA1008_10, maxx(1) - maxx(10), maxy(1) - maxy(10));
shifted_HA_11 = imshift(HA1008_11, maxx(1) - maxx(11), maxy(1) - maxy(11));


stacked_ha_1008 = sum(cat(3, HA1008_1, shifted_HA_2, shifted_HA_3, shifted_HA_4, shifted_HA_5, shifted_HA_6, shifted_HA_7, shifted_HA_8, shifted_HA_9, shifted_HA_10, shifted_HA_11), 3);

figure(4)
colormap(gray(256));
imagesc(rot90(stacked_ha_1008), [250,500]); colorbar();

%% Master JCB
localmax_jcb_1007 = stacked_jcb_1007(1960:2020, 670:700);
localmax_jcb_1008 = stacked_jcb_1008(1970:2020, 670:700);
max_jcb_1007 = max(localmax_jcb_1007(:)); [maxx_1007, maxy_1007] = find(stacked_jcb_1007 == max_jcb_1007);
max_jcb_1008 = max(localmax_jcb_1008(:));[maxx_1008, maxy_1008] = find(stacked_jcb_1008 == max_jcb_1008);
shifted_jcb_1008 = imshift(stacked_jcb_1008, maxx_1007 - maxx_1008, maxy_1007 - maxy_1008);
stacked_jcb = sum(cat(3, stacked_jcb_1007, shifted_jcb_1008),3);

figure(6)
colormap(gray(256));
imagesc(rot90(stacked_jcb), [22000, 24000]); colorbar();




%% Master Ha
localmax_ha_1007 = stacked_ha_1007(1970:2010, 690:710);
localmax_ha_1008 = stacked_ha_1008(1980:2015, 670:700);
max_ha_1007 = max(localmax_ha_1007(:)); [maxx_1007, maxy_1007] = find(stacked_ha_1007 == max_ha_1007);
max_ha_1008 = max(localmax_ha_1008(:));[maxx_1008, maxy_1008] = find(stacked_ha_1008 == max_ha_1008);
shifted_ha_1008 = imshift(stacked_ha_1008, maxx_1007 - maxx_1008, maxy_1007 - maxy_1008);
stacked_ha = sum(cat(3, stacked_ha_1007, shifted_ha_1008),3);

figure(7)
colormap(gray(256));
imagesc(rot90(stacked_ha), [1000, 3500]); colorbar();